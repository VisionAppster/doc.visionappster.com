
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Positioning with QR codes &mdash; VisionAppster  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/docsearch.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/v.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="../../_static/js/docsearch.min.js"></script>
        <script defer="defer" src="../../_static/js/algolia.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Code reading for Raspberry Pi" href="../raspi-code-reading/" />
    <link rel="prev" title="Yolo V4 object detection with OpenCV and Python" href="../python-yolov4/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <div data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search" >
        

        
          <a href="../../">
        

        
          
          <img src="../../_static/visionappster.png" class="logo" alt="Logo">
        
        </a>

        
          
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <nav class="wy-nav-side-inner">
        <div class="wy-side-scroll">
          
          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
                
              
              
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../engine/">Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builder/">Builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Built-in tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components/">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cameras/">Cameras</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../analyze-blob-geometry/">Analyze Blob Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binarize/">Binarize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blurring/">Blurring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caliper/">Caliper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-reading/">Code reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contour-matching/">Contour matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../detect-blobs/">Detect Blobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image-classifier/">Image classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual-calibration/">Manual Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../motion-detector/">Motion detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opencv-tools/">OpenCV Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-superresolution/">Super-resolution with OpenCV and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-yolov4/">Yolo V4 object detection with OpenCV and Python</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Positioning with QR codes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#downloads">Downloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-description">Detailed description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../raspi-code-reading/">Code reading for Raspberry Pi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../texture-matching/">Texture matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unsharp-masking/">Unsharp Masking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web-app/">Web app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../white-balance/">White Balance Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yolo-classifier/">YOLO classifier</a></li>
</ul>
</li>
</ul>

              
            
          </div>
          
        </div>
      </nav>
    </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">VisionAppster</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../">Cookbook</a> &raquo;</li>
        
      <li>Positioning with QR codes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="positioning-with-qr-codes">
<h1>Positioning with QR codes<a class="headerlink" href="#positioning-with-qr-codes" title="Permalink to this headline">ðŸ”—</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">ðŸ”—</a></h2>
<p>QR codes can be used to determine the position of the camera with
respect to the plane where the QR code lies. The origin of the resulting
coordinate system will be at the upper left corner of the QR code.</p>
<p>We assume that there is only one QR code in the image and the length of
the edge of the code is known. The actual information content of the
code is not relevant in the positioning process. The positioning is
based solely on the relative positions of the corner patterns of the
code.</p>
</div>
<div class="section" id="downloads">
<h2>Downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">ðŸ”—</a></h2>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="../../_downloads/8313fae3c320695bb87f0f6064394ac7/CookbookQrPositioning.zip"><code class="xref download docutils literal notranslate"><span class="pre">Project</span> <span class="pre">file</span></code></a></p></li>
</ul>
</div>
<div class="section" id="detailed-description">
<h2>Detailed description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">ðŸ”—</a></h2>
<p>Let us walk through the schema below top-down.</p>
<div class="medium figure align-default" id="id1">
<img alt="Complete processing graph." src="../../_images/qr-positioning-1.png" />
<p class="caption"><span class="caption-text">Complete processing graph.</span><a class="headerlink" href="#id1" title="Permalink to this image">ðŸ”—</a></p>
</div>
<p>Before delving into details, letâ€™s see where we are aiming at. The upper
picture below shows the input image containing a QR code and a ruler.
The picture is taken from an unknown angle. The lower picture is a
perspective corrected version of the input image. The content of the QR
code is also shown, as well as Euler angles of rotation. More on them
later.</p>
<div class="medium figure align-default" id="id2">
<img alt="The target is to straighten an image taken from an unknown angle." src="../../_images/qr-positioning-6.png" />
<p class="caption"><span class="caption-text">The target is to straighten an image taken from an unknown angle.</span><a class="headerlink" href="#id2" title="Permalink to this image">ðŸ”—</a></p>
</div>
<ul class="simple">
<li><p>The image originates from the virtual camera configured in <a class="reference internal" href="../../tools/ImageSource/"><span class="doc">Image
Source</span></a>. <code class="docutils literal notranslate"><span class="pre">Position</span></code> parameters are disabled
by default. The focal length in terms of pixel units on the sensor
must be known as accurately as possible. Focal length can be
determined quickly (but not very accurately) using the method
explained in the cookbook entry on <a class="reference internal" href="../manual-calibration/"><span class="doc">Manual
Calibration</span></a>. The most accurate way
to determine the focal length is to use a proper calibration plate
and the calibration tool in te Camera Configurator. In this example,
the focal length is 2000 pixels. Likewise, the most accurate method
for positioning (i.e.Â perpective correction) is to use the
positioning tool in Camera Configurator. A benefit of using a QR code
for positioning is simplicity because the calibration plate is not
needed. Any QR code with a known edge length will do.</p></li>
<li><p>Several tools downstream need to know the threshold between the dark
and bright modules in the QR code. An estimate of such a threshold is
given by <a class="reference internal" href="../../tools/FindThresholdTool/"><span class="doc">Find Threshold</span></a>. Input for the
threshold finder is a histogram calculated over the whole image.</p></li>
</ul>
<div class="medium figure align-default" id="id3">
<img alt="The focal length of the camera must be known. If unsure, use trial and error." src="../../_images/qr-positioning-2.png" />
<p class="caption"><span class="caption-text">The focal length of the camera must be known. If unsure, use trial
and error.</span><a class="headerlink" href="#id3" title="Permalink to this image">ðŸ”—</a></p>
</div>
<ul class="simple">
<li><p>The image is passed to <a class="reference internal" href="../../tools/FindQrKeyPointsTool/"><span class="doc">Find Qr Key
Points</span></a>. The tool has to know the
length of the edge of the QR code. In this case, <code class="docutils literal notranslate"><span class="pre">Edge</span> <span class="pre">Length</span></code> is
32 mm. <code class="docutils literal notranslate"><span class="pre">Threshold</span></code> sets the limit between dark and bright modules
in the code and <code class="docutils literal notranslate"><span class="pre">Invert</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code> means that the code has black
modules on a light background. The tool detects 13 key points in the
QR code and outputs the pixel coordinates and the corresponding world
coordinates. This is demonstrated in the picture below by connecting
the points with yellow lines.</p></li>
</ul>
<div class="medium figure align-default" id="id4">
<img alt="Detected key points laid over the input image" src="../../_images/qr-positioning-7.png" />
<p class="caption"><span class="caption-text">Detected key points laid over the input image</span><a class="headerlink" href="#id4" title="Permalink to this image">ðŸ”—</a></p>
</div>
<ul class="simple">
<li><p>The two point sets are passed to
<a class="reference internal" href="../../tools/HomographyTool/"><span class="doc">Homography</span></a>. The tool calculates a matrix
that maps the coordinates of the detected key points to the known
reference coordinates. This frame describes the position of the
camera with respect to the world plane.</p></li>
<li><p>The frame is passed to <a class="reference internal" href="../../tools/ReplaceCoordinateFrameTool/"><span class="doc">Replace Coordinate
Frame</span></a> together with the image.
The tool attaches the frame to the image without modifying the
pixels.</p></li>
<li><p>The frame is also passed to <a class="reference internal" href="../../tools/FrameToAnglesTool/"><span class="doc">Frame to
Angles</span></a> which calculates Euler angles in
degrees. They describe 3D rotation of the camera with respect to the
QR code.</p></li>
</ul>
<div class="medium figure align-default" id="id5">
<img alt="The homography between detected and known key point coordinates is used as a new coordinate frame." src="../../_images/qr-positioning-4.png" />
<p class="caption"><span class="caption-text">The homography between detected and known key point coordinates is
used as a new coordinate frame.</span><a class="headerlink" href="#id5" title="Permalink to this image">ðŸ”—</a></p>
</div>
<ul class="simple">
<li><p>Unrelated to the positioning procedure, the QR code is also located
in <a class="reference internal" href="../../tools/FindMatrixCodeTool/"><span class="doc">Matrix Code Detection</span></a>. Based on
the position information passed in <code class="docutils literal notranslate"><span class="pre">Frame</span></code> and <code class="docutils literal notranslate"><span class="pre">Size</span></code> matrices,
the contents are read by <a class="reference internal" href="../../tools/ReadMatrixCodeTool/"><span class="doc">Matrix Code
Reading</span></a>. If you are not interested in
the information content of the QR code, these tools can be omitted.
Notice the that information about the size of the edge (32 mm in this
case) could be written to the QR code. It could be read with Matrix
Code Reading tool and fed back to QR Key Point Detection tool with a
simple script that converts the <code class="docutils literal notranslate"><span class="pre">Code</span></code> output string to a number.
This way the size of the QR code would not need to be hardcoded in
the application.</p></li>
</ul>
<div class="small figure align-default" id="id6">
<img alt="The contents of the QR code can optionally be readed simultaneously." src="../../_images/qr-positioning-3.png" />
<p class="caption"><span class="caption-text">The contents of the QR code can optionally be readed simultaneously.</span><a class="headerlink" href="#id6" title="Permalink to this image">ðŸ”—</a></p>
</div>
<p>Finally, letâ€™s verify that the image is correctly positioned. For this
end, we attach a <a class="reference internal" href="../../tools/CaliperTool/"><span class="doc">Caliper</span></a> to the corrected image
coming from <a class="reference internal" href="../../tools/ReplaceCoordinateFrameTool/"><span class="doc">Set Coordinate Frame</span></a>
and set the start and end points of the measurement line to left and
right sides of the perspective-corrected image. The width of the
measurement line is set as 0.5 mm.</p>
<p>Caliper calculates plenty of information about the gaps. We use only the
distances of the begin and end points of the gaps measured from the
beginning of the measurement line. This information is comes from
<code class="docutils literal notranslate"><span class="pre">Gap</span> <span class="pre">Start</span> <span class="pre">Length</span></code> and <code class="docutils literal notranslate"><span class="pre">Gap</span> <span class="pre">End</span> <span class="pre">Length</span></code> outputs. The unit of the
length is now in millimeters because we told <a class="reference internal" href="../../tools/FindQrKeyPointsTool/"><span class="doc">QR Key Point
Detection</span></a> above how long the edge of the
QR code is.</p>
<p>The start and end length are passed to a simple script which calculates
the difference between the beginning of the first gap and the end of the
last gap. In this case the measurement error is about 0.1 mm, meaning
0.3% relative error. There are roughly 10 pixels per millimeter in the
input image so 0.1 mm corresponds to one pixel. The caliper measures the
width of the edge of the code correctly as 32mm.</p>
<div class="medium figure align-default" id="id7">
<img alt="The width of the QR code can now be measured with a relative accuracy of 0.3%." src="../../_images/qr-positioning-5.png" />
<p class="caption"><span class="caption-text">The width of the QR code can now be measured with a relative accuracy
of 0.3%.</span><a class="headerlink" href="#id7" title="Permalink to this image">ðŸ”—</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../raspi-code-reading/" class="btn btn-neutral float-right" title="Code reading for Raspberry Pi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../python-yolov4/" class="btn btn-neutral float-left" title="Yolo V4 object detection with OpenCV and Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, VisionAppster.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-129514554-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>