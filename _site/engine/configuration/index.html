
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Configuration &mdash; VisionAppster  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/docsearch.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/v.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="../../_static/js/docsearch.min.js"></script>
        <script defer="defer" src="../../_static/js/algolia.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Graph executor" href="../graph-executor/" />
    <link rel="prev" title="Apps" href="../apps/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <div data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search" >
        

        
          <a href="../../">
        

        
          
          <img src="../../_static/visionappster.png" class="logo" alt="Logo">
        
        </a>

        
          
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <nav class="wy-nav-side-inner">
        <div class="wy-side-scroll">
          
          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
                
              
              
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Engine</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../#main-elements">Main elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../#supported-platforms">Supported platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apps/">Apps</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#linux">Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-interface">Network interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ip-based-access-control">IP-based access control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cors">CORS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opc-ua">OPC UA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../graph-executor/">Graph executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware-devices/">Hardware devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../management-interface/">Management interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../remote-object-system/">Remote object system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/">VisionAppster Engine services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start-stop/">Starting and stopping the Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-apis/">Testing HTTP APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web-apps/">Web apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../world-coordinates/">World coordinates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../builder/">Builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Built-in tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components/">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cameras/">Cameras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook/">Cookbook</a></li>
</ul>

              
            
          </div>
          
        </div>
      </nav>
    </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">VisionAppster</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../">Engine</a> &raquo;</li>
        
      <li>Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">ðŸ”—</a></h1>
<p>The VisionAppster Engine consists of a bunch of software modules that
are available to all apps. The <code class="docutils literal notranslate"><span class="pre">va-engine</span></code> service that runs on the
background is actually a <a class="reference internal" href="../apps/"><span class="doc">VisionAppster app</span></a> itself. It is
started through <code class="docutils literal notranslate"><span class="pre">va-run</span></code> as any app could. In Linux, the init system
(usually systemd) runs <code class="docutils literal notranslate"><span class="pre">va-run</span></code> directly. In Windows, the service
control manager communicates with a service wrapper,
<code class="docutils literal notranslate"><span class="pre">va-engine-service.exe</span></code>.</p>
<p>The app is called <code class="docutils literal notranslate"><span class="pre">init.qml</span></code> and stored in the <code class="docutils literal notranslate"><span class="pre">init</span></code> directory
under the VisionAppster installation root. There is also an alternative
app called <code class="docutils literal notranslate"><span class="pre">api-init.qml</span></code> that is intended for running a fixed set of
apps and to publish their APIs.</p>
<p>Since the Engine lets one to install and run new components through the
HTTP interface, it is extremely important to set up access control
correctly. A failure in doing so will easily lead into a remote code
execution vulnerability. Therefore, prefer <code class="docutils literal notranslate"><span class="pre">api_init.qml</span></code> for
production use as it does not expose remote management APIs.</p>
<p>There are two ways the <code class="docutils literal notranslate"><span class="pre">va-engine</span></code> service can be configured: via
command-line arguments or by modifying the <code class="docutils literal notranslate"><span class="pre">init.qml</span></code> or
<code class="docutils literal notranslate"><span class="pre">api_init.qml</span></code> script. In command-line arguments, the first argument
is always the path to the used init script. Additional supported
arguments are documented in the init script. Operating systems differ in
their ways of passing service start-up parameters.</p>
<div class="section" id="linux">
<h2>Linux<a class="headerlink" href="#linux" title="Permalink to this headline">ðŸ”—</a></h2>
<p>In Linux, command-line arguments are given in a systemd unit file
(<code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/va-engine.service</span></code>) using the <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code>
variable. For example, to use <code class="docutils literal notranslate"><span class="pre">api_init.qml</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rest of configuration omitted.</span>

<span class="k">[Service]</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/visionappster/bin/va-run /opt/visionappster/init/api_init.qml</span>
</pre></div>
</div>
<p>If you need to edit the init scripts, they are placed in:</p>
<ul class="simple">
<li><p>Tarball installer: <code class="docutils literal notranslate"><span class="pre">/va-engine/overlay/opt/visionappster/init</span></code> by
default</p></li>
<li><p>Raspberry Pi and Docker: <code class="docutils literal notranslate"><span class="pre">/opt/visionappster/init</span></code></p></li>
<li><p>Flatpak: Typing <code class="docutils literal notranslate"><span class="pre">flatpak</span> <span class="pre">info</span> <span class="pre">-l</span> <span class="pre">com.visionappster.Builder</span></code> will
give you the root of the installed Flatpak. The init files are in
<code class="docutils literal notranslate"><span class="pre">files/opt/visionappster/init</span></code> under the Flatpak root.</p></li>
</ul>
<p>Reload the new configuration and restart the service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl restart va-engine
</pre></div>
</div>
</div>
<div class="section" id="windows">
<h2>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">ðŸ”—</a></h2>
<p>In Windows, the service control manager reads service configuration from
the registry. The easiest way to change start-up parameters is to use
the <code class="docutils literal notranslate"><span class="pre">sc</span></code> service management tool to set the <code class="docutils literal notranslate"><span class="pre">binPath</span></code> variable. For
example, to use <code class="docutils literal notranslate"><span class="pre">api_init.qml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="n">config</span> <span class="s2">&quot;VisionAppster Engine&quot;</span> <span class="o">^</span>
  <span class="n">binPath</span><span class="o">=</span><span class="s2">&quot;C:\Program Files\VisionAppster</span><span class="se">\b</span><span class="s2">in</span><span class="se">\v</span><span class="s2">a-engine-service.exe ..\init</span><span class="se">\a</span><span class="s2">pi_init.qml&quot;</span>
</pre></div>
</div>
<p>The init files are stored under the VisionAppster installation
directory, usually <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\VisionAppster\init</span></code>. To apply the
new configuration you need to restart the service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="n">stop</span> <span class="s2">&quot;VisionAppster Engine&quot;</span>
<span class="n">sc</span> <span class="n">start</span> <span class="s2">&quot;VisionAppster Engine&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="network-interface">
<h2>Network interface<a class="headerlink" href="#network-interface" title="Permalink to this headline">ðŸ”—</a></h2>
<p>The default behavior of the <code class="docutils literal notranslate"><span class="pre">init.qml</span></code> app is to bind the web server
to the loopback interface only. This blocks all external connection
attempts. <code class="docutils literal notranslate"><span class="pre">api-init.qml</span></code> binds to all available interfaces by default.</p>
<p>The web server can be bound to a specific interface or to all available
interfaces. For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">127.0.0.1:2015</span></code> - Bind to IPv4 loopback only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[::1]:2015</span></code> - Bind to IPv6 loopback only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0.0.0.0:2015</span></code> - Bind to all IPv4 interfaces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[::]:2015</span></code> - Bind to all IPv6 interfaces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">192.168.1.5:2015</span></code> - Bind to a specific IPv4 address.</p></li>
</ul>
<p>The port number (2015) could be anything else, but some client software
may assume the standard port.</p>
<p>Note that binding the server to a non-local interface makes it possible
to access it from other computers. You may want to disable remote
management (use <code class="docutils literal notranslate"><span class="pre">api_init.qml</span></code>) and/or use IP-based access control in
this case.</p>
<p>The web serverâ€™s network interface can be changed on the command line
using the <code class="docutils literal notranslate"><span class="pre">webServer</span></code> variable. For example, to allow access from
remote computers, bind the web server to port 2015 on all IPv4
interfaces:</p>
<p><strong>Linux</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">visionappster</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">va</span><span class="o">-</span><span class="n">run</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">visionappster</span><span class="o">/</span><span class="n">init</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">qml</span> <span class="n">webServer</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">2015</span>
</pre></div>
</div>
<p><strong>Windows</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="n">config</span> <span class="s2">&quot;VisionAppster Engine&quot;</span> <span class="o">^</span>
  <span class="n">binPath</span><span class="o">=</span><span class="s2">&quot;C:\Program Files\VisionAppster</span><span class="se">\b</span><span class="s2">in</span><span class="se">\v</span><span class="s2">a-engine-service.exe ..\init\init.qml webServer=0.0.0.0:2015&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="ip-based-access-control">
<h2>IP-based access control<a class="headerlink" href="#ip-based-access-control" title="Permalink to this headline">ðŸ”—</a></h2>
<p>The web server supports IP subnet based access control. If no access
control rules have been specified, requests from any IP will be
accepted. Once a single rule has been set up, the default behavior
changes to deny requests. The access control rules work on the TCP
layer, blocking the connection before HTTP has a chance to parse the
request.</p>
<p>The access control mechanism maintains a list of rules that either allow
or deny access based on the clientâ€™s IP address. The first matching rule
will determine the fate of the client. The following example denies
access from a certain evil IP subnet.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Block evil IPs.</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">denyFrom</span><span class="p">(</span><span class="s1">&#39;64.233.160.0/19&#39;</span><span class="p">);</span>
<span class="c1">// An empty address means &quot;everybody&quot;. Allow everybody else.</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">allowFrom</span></code> and <code class="docutils literal notranslate"><span class="pre">denyFrom</span></code> functions accept IPv4 and IPv6
addresses and subnets. Examples:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">webServer</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="s1">&#39;10.0.0.0/255.255.255.0&#39;</span><span class="p">);</span> <span class="c1">// IPv4 address/netmask</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">denyFrom</span><span class="p">(</span><span class="s1">&#39;10.0.0.0/24&#39;</span><span class="p">);</span> <span class="c1">// Same in CIDR notation</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="s1">&#39;10.0.0.1&#39;</span><span class="p">);</span> <span class="c1">// IPv4 host address</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">denyFrom</span><span class="p">(</span><span class="s1">&#39;fe80::a65d:36ff:fec8:aced&#39;</span><span class="p">);</span> <span class="c1">// IPv6 host address</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="s1">&#39;fe80::/64&#39;</span><span class="p">);</span> <span class="c1">// IPv6 subnet</span>
<span class="nx">webServer</span><span class="p">.</span><span class="nx">denyFrom</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// Any IP address (v4 or v6)</span>
</pre></div>
</div>
<p>IP-based access control can only be enabled by editing the init script.</p>
</div>
<div class="section" id="cors">
<h2>CORS<a class="headerlink" href="#cors" title="Permalink to this headline">ðŸ”—</a></h2>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a> is a
technique implemented by browsers to allow web pages to make requests to
servers they did not originate from. Since this is generally unsafe, the
target server must be explicitly configured to accept the requests.</p>
<p>The Engineâ€™s web server disallows CORS requests by default. That is,
scripts loaded from a web server other than the Engineâ€™s own will not be
able to make requests to it. Note however that this only applies to
browsers. A malicious Node.js script run locally can still make requests
to the server. The <code class="docutils literal notranslate"><span class="pre">api-init.qml</span></code> app does not expose unsafe features
to the web server and therefore enables CORS:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">WebServer</span>
<span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="nx">webServer</span>
  <span class="nx">corsEnabled</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This allows CORS requests made by any script independent of its origin.
For a more fine-grained control one can specify which domains are
allowed to make CORS requests:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">WebServer</span>
<span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="nx">webServer</span>
  <span class="nx">corsEnabled</span><span class="o">:</span> <span class="kc">true</span>
  <span class="nx">corsOrigins</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;https://doc.visionappster.com&#39;</span><span class="p">,</span> <span class="s1">&#39;http://safe.site:8888&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Do not enable CORS if you donâ€™t fully understand the security
consequences. If you do, consider adding IP-based access control.</p>
<p>CORS can only be enabled by editing the init script.</p>
</div>
<div class="section" id="opc-ua">
<h2>OPC UA<a class="headerlink" href="#opc-ua" title="Permalink to this headline">ðŸ”—</a></h2>
<p>The built-in OPC UA server will not be started by default. To enable it,
pass a network interface specification on the command line using the
<code class="docutils literal notranslate"><span class="pre">opcUaServer</span></code> variable. To bind the OPC UA server to port 4015 on all
IPv4 interfaces:</p>
<p><strong>Linux</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">visionappster</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">va</span><span class="o">-</span><span class="n">run</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">visionappster</span><span class="o">/</span><span class="n">init</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">qml</span> <span class="n">opcUaServer</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4015</span>
</pre></div>
</div>
<p><strong>Windows</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="n">config</span> <span class="s2">&quot;VisionAppster Engine&quot;</span> <span class="o">^</span>
  <span class="n">binPath</span><span class="o">=</span><span class="s2">&quot;C:\Program Files\VisionAppster</span><span class="se">\b</span><span class="s2">in</span><span class="se">\v</span><span class="s2">a-engine-service.exe ..\init\init.qml opcUaServer=0.0.0.0:4015&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../graph-executor/" class="btn btn-neutral float-right" title="Graph executor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../apps/" class="btn btn-neutral float-left" title="Apps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, VisionAppster.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-129514554-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>